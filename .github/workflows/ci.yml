name: CI Pipeline for Titanic Analysis

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run basic Python test
      run: |
        python -c "
        # Простой тест без pytest
        from src.titanic_app import TitanicAnalysis
        import pandas as pd
        
        # Создаем тестовые данные
        data = {
            'PassengerId': [1, 2],
            'Survived': [1, 0], 
            'Pclass': [1, 3],
            'Sex': ['female', 'male'],
            'Fare': [50.0, 10.0]
        }
        df = pd.DataFrame(data)
        df.to_csv('test_data.csv', index=False)
        
        # Тестируем
        analyzer = TitanicAnalysis('test_data.csv')
        assert len(analyzer.df) == 2
        print('✅ Все тесты прошли успешно!')
        "

    - name: Check code style
      run: |
        python -c "
        # Проверка стиля кода
        import subprocess
        import sys
        
        try:
            result = subprocess.run(['flake8', 'src/', '--max-line-length=127'], 
                                  capture_output=True, text=True)
            if result.returncode == 0:
                print('✅ Стиль кода отличный!')
            else:
                print('⚠️  Замечания по стилю:')
                print(result.stdout)
                sys.exit(1)
        except Exception as e:
            print(f'✅ Flake8 проверка пропущена: {e}')
        "
